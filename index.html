<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KNN Movie Recommender</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
  body {
    background-color: #0b0f17;
    color: #f5f5f5;
    font-family: 'Inter', sans-serif;
  }

  h1 { color: #ff1f1f; }

  .floating-card {
    transition: 0.3s ease;
  }
  .floating-card:hover {
    transform: translateY(-4px);
  }

  /* ---------------------- CAROUSEL ---------------------- */
  .carousel-wrapper {
    position: relative;
  }

  .carousel {
    display: flex;
    overflow-x: auto;
    scroll-behavior: smooth;
    gap: 1rem;
    padding: 1rem 0;
  }
  .carousel::-webkit-scrollbar { display: none; }

  .movie-card {
    min-width: 200px;
    background: #1c1c1c;
    border-radius: 1rem;
    box-shadow: 0 6px 15px rgba(0,0,0,0.5);
    transition: 0.5s ease;
  }
  .movie-card:hover {
    transform: scale(1.05);
    box-shadow: 0 15px 25px rgba(0,0,0,0.8);
  }

  .movie-image {
    width: 100%;
    height: 260px;
    border-radius: 1rem 1rem 0 0;
    object-fit: cover;
  }

  .movie-info { padding: 1rem; }
  .movie-title { font-weight: bold; font-size: 1rem; }
  .movie-genres { font-size: 0.8rem; color: #bbb; }

  /* ---------------------- ARROWS ---------------------- */
  .arrow-btn {
    position: absolute;
    top: 40%;
    transform: translateY(-50%);
    height: 48px;
    width: 48px;
    background: rgba(255,255,255,0.12);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2rem;
    color: #ff1f1f;
    cursor: pointer;
    z-index: 50;
    backdrop-filter: blur(6px);
    transition: 0.3s ease;
  }

  .arrow-btn:hover {
    background: rgba(255,0,0,0.8);
    color: white;
    transform: translateY(-50%) scale(1.1);
  }

  .left-arrow { left: -25px; }
  .right-arrow { right: -25px; }

  /* ---------------------- GRAPH ---------------------- */
  .graph-img {
    width: 100%;
    max-width: 650px;
    margin: 0 auto;
    display: block;
    border-radius: 1rem;
    box-shadow: 0 10px 25px rgba(0,0,0,0.7);
  }

  /* ---------------------- BUTTON ---------------------- */
  .big-red-btn {
    background: #ff1f1f;
    color: white;
    font-weight: 600;
    padding: 0.9rem;
    border-radius: 0.75rem;
    transition: 0.3s ease;
    box-shadow: 0 5px 10px rgba(255,0,0,0.4);
  }

  .big-red-btn:hover {
    background: #cc0000;
    transform: scale(1.05);
    box-shadow: 0 10px 20px rgba(255,0,0,0.6);
  }

</style>
</head>

<body class="p-6 sm:p-10 flex justify-center">

<div class="max-w-4xl w-full bg-gray-900 p-6 md:p-10 rounded-3xl shadow-2xl floating-card">

    <h1 class="text-4xl font-extrabold text-center mb-4">ðŸŽ¬ KNN Movie Recommender</h1>
    <p class="text-gray-400 text-center mb-6">
        Search a movie and get smart AI recommendations instantly.
    </p>

    <!-- Search Form -->
    <form method="POST" class="mb-8 flex flex-col gap-4">
        <input type="text" name="movie_name" placeholder="Enter movie name..."
               class="w-full px-4 py-3 rounded-xl text-gray-900 font-medium shadow-lg focus:ring-4 focus:ring-red-600"
               value="{{ movie_name or '' }}" 
               {% if all_movies %}list="movieList"{% endif %}>

        {% if all_movies %}
        <datalist id="movieList">
            {% for movie in all_movies %}
                <option value="{{ movie }}">
            {% endfor %}
        </datalist>
        {% endif %}

        <button type="submit" class="big-red-btn">Get Recommendations</button>
    </form>

    <!-- Recommendations -->
    {% if recommendations %}
    {% if recommendations|length > 0 %}

    <!-- TOP 5 CAROUSEL -->
    <h2 class="text-2xl font-bold text-red-400 mb-2">Top 5 Recommendations</h2>

    <div class="carousel-wrapper">

        <div class="arrow-btn left-arrow" onclick="scrollCarousel(-1)">&#10094;</div>

        <div id="movieCarousel" class="carousel">
            {% for movie in recommendations[:5] %}
            <div class="movie-card">
                <img class="movie-image"
                     src="https://placehold.co/200x260/222/ff1f1f?text={{ movie }}"
                     alt="{{ movie }}">
                <div class="movie-info">
                    <div class="movie-title">{{ movie }}</div>
                    <div class="movie-genres">Action | Adventure</div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="arrow-btn right-arrow" onclick="scrollCarousel(1)">&#10095;</div>

    </div>

    <!-- GRAPH -->
    {% if plot_path %}
    <div class="mt-10 text-center">
        <h3 class="text-xl font-semibold mb-4 text-red-400">Similarity Graph</h3>

        <img src="{{ url_for('static', filename='plots/similarity.png') }}?t={{ g.now }}"
             alt="Similarity Plot" class="graph-img"
             onerror="this.src='https://placehold.co/650x300/222/ff1f1f?text=Plot+Unavailable'">

        <p class="text-gray-400 mt-3 text-sm">
            Shows cosine similarity between searched movie and recommendations.
        </p>
    </div>
    {% endif %}

    <!-- OTHER RECOMMENDATIONS (IF ANY) -->
    {% if recommendations|length > 5 %}
    <h2 class="text-xl font-semibold text-gray-300 mt-8 mb-2">More Recommendations</h2>
    <ul class="space-y-3">
        {% for movie in recommendations[5:] %}
        <li class="p-3 bg-gray-800 rounded-lg shadow hover:bg-gray-700 transition">
            {{ movie }}
        </li>
        {% endfor %}
    </ul>
    {% endif %}

    {% endif %}
    {% endif %}

</div>

<!-- Carousel scroll script -->
<script>
function scrollCarousel(direction) {
    const carousel = document.getElementById("movieCarousel");
    const cardWidth = 230;
    carousel.scrollBy({ left: direction * cardWidth, behavior: "smooth" });
}
</script>

</body>
</html>
